# json通讯协议说明
------------------------
版本：**V0.0.1**
## 1.前言
* 对上层是服务器，在资源够用的情况下，推荐解析协议采用**json格式**。json格式和字节流格式**只是**格式上的不通，**内容**上应该是**一致的**。文档按照json在加以说明，字节流可参阅“_MCU私有协议规范_”。
## 2.详细协议
### 2.1json格式

```json
{
	"sn": "88888888", // SN
	"cat":0,		  // 设备类别
	"profile":0,	  // 协议版本
	"cmd": 1,		  // 命令字
	"payload": {	  // 数据
        "xxx": xxxx
	}
}
```

**sn**

8字节字符，串区分设备

**cat**

设备类别，区分当前设备是网关还是传感器。

| 关键字   |              |      |
| -------- | ------------ | ---- |
| nb_g     | nbiot的网关  |      |
| nb_n     | nbiot的节点  |      |
| zigbee_g | zigbee的网关 |      |
| zigbee_n | zigbee的节点 |      |
| wifi_g   | wifi的网关   |      |
| wifi_n   | wifi的节点   |      |
| 。。。   |              |      |
| 。。。   |              |      |

**profile**

配置文件，可以理解成当前报文的版本。根据cat与profile，明确该报文的解析。表明用哪种设备的哪个版本的协议去解析。

**cmd**

命令字，payload的内容类别。

**payload**

负载内容，根据不同profile的不同cmd而不同。

### 2.2nb_n
nb类型的节点
**Json**格式：
```json
{
	"sn": "88888888", // SN
	"cat":"nb_n",		  // 设备类别
	"profile":0,	  // 协议版本
	"rssi":25,
	"ack":0,
	"cmd": xxxx,		  // 命令字
	"payload": {	  // 数据
        "xxx": xxxx
	}
}
```
* 添加rssi作为信号状态
* ack:该报是否是需要ack应答
## 3.cmd规范
> 对于同一种类型的设备，其标准命令对应的CmdPayload格式是固定的，不允许修改。不同类型的标准命令可以有区别。

> 自定义命令为不同设备私有命令，对字段格式按设备需求自定义，自定义命名必须从128开始。

> 标准命令为一个命令集，不同的设备可能只支持其中某些标准命令
```c
typedef enum
{
    /*标准命令 */
	0,    // 不支持的命令应答
	1,    // 获取支持的命令列表请求
	2,    // 获取支持的命令列表应答
	10,   // 心跳
    11,   // 获取版本号请求
    12,   // 获取版本号应答
    13,   // 时间设置请求
    14,   // 时间设置应答
    15,   // 时间获取请求
    16,   // 时间获取应答
    20,	// 下载通知
    21,   // 文件名请求
    22,   // 文件名应答
    23,	// 文件信息请求
    24,	// 文件信息应答
    25,	// 文件数据请求
    26,	// 文件数据应答
    /* 按ConnType类型遵循的标准命令 */
    50,    // 获取设备的传输类型和设备型号请求
	51,    // 获取设备的传输类型和设备型号应答
    60,	// 配置获取请求
    61,	// 配置获取应答
    62,	// 配置设置请求
    63,	// 配置设备应答
    64,	// 状态获取请求
    65,	// 状态获取应答
    70,	// 扫描请求
    71,	// 扫描应答
    72,   // 关联请求
    73,   // 关联应答，传感->网关组网使用
    74,	// 注册请求，到服务器用
    75,	// 注册应答
}Cmd_e;
```

### 3.1不支持的命令应答
0
```json
{
...
	"cmd": 0,		  // 命令字
	"payload": {	  // 数据
        "xxx": [ , , ]
	}
}
```
### 3.1获取支持的命令列表
请求：
1
```json
{
...
	"cmd": 1,		  // 命令字
}
```
应答：
2
```json
{
...
	"cmd": 2,		  // 命令字
	"payload": {	  // 数据
        "xxx": [ , , ]
	}
}
```
### 3.2获取版本号
请求：
11
```json
{
...
	"cmd": 11,		  // 命令字
}
```
应答：
12
```json
{
...
	"cmd": 12,		  // 命令字
	"payload": {	  // 数据
        "version": "0.0.1"
	}
}
```

........
